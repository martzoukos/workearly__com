@use "sass:math";
@use "sass:meta";
@use "sass:map";
@use "sass:list";
@use "sass:string";
@use "./colors" as *;
@use "./settings" as *;
@use "./breakpoints" as *;

@function v($name, $fallback: null) {
  @if ($fallback) {
    @return var(--#{$name}, #{$fallback});
  } @else {
    @return var(--#{$name});
  }
}

@function strip($value) {
  @if meta.type-of($value) != "number" {
    @error "Invalid `#{meta.type-of($value)}` type. Choose a number type instead.";
  } @else if meta.type-of($value) == "number" and not math.is-unitless($value) {
    @return math.div($value, ($value * 0 + 1));
  }

  @return $value;
}

@function pxToRem($value, $remValue) {
  @return math.div($value, $remValue);
}

@function fluid-rem(
  $min: 1rem,
  $max: 3rem,
  $breakpoints: (
    "sm",
    "xxl",
  ),
  $remValue: 16
) {
  $minWidth: get-breakpoint(list.nth($breakpoints, 1));
  $maxWidth: get-breakpoint(list.nth($breakpoints, 2));

  $minSizeStripped: strip($min);
  $maxSizeStripped: strip($max);
  $minWidthRem: pxToRem(strip($minWidth), $remValue);
  $maxWidthRem: pxToRem(strip($maxWidth), $remValue);
  $viewportValue: 100;

  $sizeDif: $maxSizeStripped - $minSizeStripped;
  $widthDif: $maxWidthRem - $minWidthRem;

  $slope: math.div($sizeDif, $widthDif);

  $yAxisIntersection: ((-1 * $minWidthRem) * $slope) + $minSizeStripped;

  @return clamp(
    #{$min},
    #{$yAxisIntersection}rem + #{$slope * $viewportValue}vw,
    #{$max}
  );
}

@function reverse-fluid-rem(
  $min: 3rem,
  $max: 1rem,
  $breakpoints: (
    "sm",
    "xxl",
  ),
  $remValue: 16
) {
  $minWidth: get-breakpoint(list.nth($breakpoints, 1));
  $maxWidth: get-breakpoint(list.nth($breakpoints, 2));

  $minSizeStripped: strip($min);
  $maxSizeStripped: strip($max);
  $minWidthRem: pxToRem(strip($minWidth), $remValue);
  $maxWidthRem: pxToRem(strip($maxWidth), $remValue);
  $viewportValue: 100;

  $sizeDif: $minSizeStripped - $maxSizeStripped;
  $widthDif: $maxWidthRem - $minWidthRem;

  $slope: math.div($sizeDif, $widthDif) * -1;

  $yAxisIntersection: ((-1 * $minWidthRem) * $slope) + $minSizeStripped;

  @return clamp(
    #{$max},
    #{$yAxisIntersection}rem + #{$slope * $viewportValue}vw,
    #{$min}
  );
}

@function fluid-px(
  $min: 16px,
  $max: 32px,
  $breakpoints: 375 $container,
  $remValue: 16
) {
  $strippedMin: strip($min);
  $strippedMax: strip($max);
  $minBreakPoint: list.nth($breakpoints, 1);
  $maxBreakPoint: list.nth($breakpoints, 2);

  $sizeDif: $strippedMax - $strippedMin;
  $widthDif: $maxWidthRem - $minWidthRem;

  $slope: math.div($sizeDif, $widthDif);
  $yAxisIntersection: ((-1 * $minWidthRem) * $slope) + $minSizeStripped;

  $prefered: "#{pxToRem(strip($min), $remValue)}rem + (#{strip($max)} - #{strip($min)}) * ((100vw - #{list.nth($breakpoints, 1)}px) / (#{list.nth($breakpoints, 2)} - #{list.nth($breakpoints, 1)}))";

  @return clamp(#{$min}, #{$prefered}, #{$max});
}

@function switch($min: 0rem, $max: 2rem, $breakpoint: 100%) {
  $switch: "(100vw - #{$breakpoint}) * 9999";
  @return clamp(#{$min}, #{$switch}, #{$max});
}
